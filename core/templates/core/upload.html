{% extends 'base.html' %} {% block content %}
<div
  class="min-h-screen bg-gradient-to-br from-black via-gray-900 to-gray-800 text-white font-inter flex items-center justify-center px-4"
>
  <div
    class="w-full max-w-screen-md mx-auto bg-gray-900 p-8 rounded-3xl shadow-2xl border border-gray-700"
  >
    <h2
      class="text-3xl font-bold mb-8 text-center text-white-500 tracking-wide"
    >
      Fusion AI
    </h2>

    <form id="resume-form" method="post" enctype="multipart/form-data" class="space-y-6">
      {% csrf_token %} {{ form.non_field_errors }}

      <!-- Resume File Upload -->
      <div>
        <label for="id_resume_file" class="block mb-1 font-medium text-gray-300"
          >{{ form.resume_file.label }}</label
        >
        <input
          type="file"
          name="resume_file"
          id="id_resume_file"
          class="w-full text-sm border-none rounded-2xl bg-gray-800 text-white px-4 py-2 file:bg-blue-600 file:text-white file:border-0 file:rounded-2xl file:cursor-pointer file:py-2 file:px-4 hover:file:bg-blue-700 transition-all"
        />
        <p class="text-xs text-gray-400 mt-1">
          {{ form.resume_file.help_text }}
        </p>
        {{ form.resume_file.errors }}
      </div>

      <!-- Resume Text Area -->
      <div>
        <label for="id_resume_text" class="block mb-1 font-medium text-gray-300"
          >{{ form.resume_text.label }}</label
        >
        <textarea
          name="resume_text"
          id="id_resume_text"
          rows="6"
          class="w-full bg-gray-800 text-white px-4 py-3 rounded-2xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400"
          placeholder="Paste your resume here..."
        >
{{ form.resume_text.value|default_if_none:'' }}</textarea
        >
        <p class="text-xs text-gray-400 mt-1">
          {{ form.resume_text.help_text }}
        </p>
        {{ form.resume_text.errors }}
      </div>

      <!-- JD Text Area -->
      <div>
        <label for="id_jd_text" class="block mb-1 font-medium text-gray-300"
          >{{ form.jd_text.label }}</label
        >
        <textarea
          name="jd_text"
          id="id_jd_text"
          rows="6"
          class="w-full bg-gray-800 text-white px-4 py-3 rounded-2xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400"
          placeholder="Paste the job description here..."
        >
{{ form.jd_text.value|default_if_none:'' }}</textarea
        >
        <p class="text-xs text-gray-400 mt-1">{{ form.jd_text.help_text }}</p>
        {{ form.jd_text.errors }}
      </div>

      <!-- Submit Button with Spinner -->
      <div class="relative">
        <button
          type="submit"
          id="match-btn"
          class="w-full flex justify-center items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 transition-all duration-300 text-white font-semibold py-3 px-6 rounded-2xl shadow-lg hover:shadow-blue-800/50"
        >
          <span id="btn-text">Match Resume</span>
          <svg
            id="spinner"
            class="hidden h-5 w-5 text-white animate-spin"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
            ></path>
          </svg>
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %} {% block extra_scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("resume-form");
    const spinner = document.getElementById("spinner");
    const btnText = document.getElementById("btn-text");
    const matchBtn = document.getElementById("match-btn");

    if (!form || !spinner || !btnText || !matchBtn) {
      console.error(
        "Spinner functionality could not be initialized: one or more required elements are missing."
      );
      return;
    }

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      btnText.textContent = "Matching Resume....";
      spinner.classList.remove("hidden");
      matchBtn.disabled = true;
      matchBtn.classList.add("opacity-75", "cursor-not-allowed");
      requestAnimationFrame(() => {
        setTimeout(() => {
          form.submit();
        }, 10);
      });
    });
  });
</script>
{% endblock %}
{% block resume_data_scripts %}
{{form.resume_text.value|json_script:"resume-data" }}
{{form.jd_text.value|json_script:"jd-data" }}
{% endblock %}
